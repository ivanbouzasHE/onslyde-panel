<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>onslyde</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="onslyde, audience engagement">
    <meta name="author" content="Wesley Hales">

    <style>
        body {
            padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
        }

        ul {
            list-style: none;
        }

        b {
            font-family: "DroidSansBold","Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        span.green {
            color: rgb(46, 204, 46);
        }

        span.red {
            color: red;
        }
    </style>


    <script src="js/libs/Chart.min.js"></script>

</head>

<body>

<div id="main-container" class="container-fluid">
    <header class="row-fluid">
        <div class="span9"><h1 class="no-bold">onslyde</h1><h3 class="no-bold">realtime audience interaction</h3></div>
        <div class="span3">

        </div>
    </header>





    <section class="main row-fluid">

        <div class="span12">
            <div ng-app="project">

                <div ng-view></div>

                <!-- CACHE FILE: list.html -->
                <script type="text/ng-template" id="list.html">
                    <input type="text" ng-model="endpointName" placeholder="Enter your session ID here" ng-change="declareEndpoint(endpointName)"> (use 167 to view example data from <a href="http://onslyde.com/example-deck.html">the demo</a>)
                    <hr/>
                    <ul>
                        <li><h2>Session ID: {{projects.id}}</h2></li>
                        <li><b>Name:</b> {{projects.sessionName}}</li>
                        <li><b>Last Session Date:</b> {{projects.start | date:'medium'}}</li>
                        <li><b>Total Polls:</b> {{projects.slideGroups.length}}</li>
                    </ul>

                    <hr/>

                    <div ng-repeat="project in projects.slideGroups | filter:search | orderBy:'created'">

                        <ul>
                            <li><h3>Poll Start:</b> {{project.created | date:'medium'}}</h3></li>
                            <li><b>Poll Options:</b> <ul ng-repeat="option in project.slideGroupOptionses"><li>{{option.name}}</li></ul></li>
                            <li><b>Total Attendee Votes:</b> {{project.slideGroupVoteses.length}}</li>
                            <li><b>Total Positive Votes:</b> <span class="green">{{project.slideGroupVoteses | totalPositive}}</span></li>
                            <li><b>Total Negative Votes:</b> <span class="red">{{project.slideGroupVoteses | totalNegative}}</span></li>
                            <li><b>Attendee Votes:</b>
                                <table class="table table-striped table-condensed table-hover">
                                    <thead>
                                    <tr>
                                        <th class="id">Vote</th>
                                        <th class="name">Vote Time</th>
                                        <th class="description">Attendee ID</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="vote in project.slideGroupVoteses | orderBy:'voteTime'">
                                        <td>{{vote.slideGroupOptions.name}}</td>
                                        <td>{{vote.voteTime  | date:'medium'}}</td>
                                        <td>{{vote.attendee.ip}}</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div ng-repeat="slide in project.slides">
                                    <b>Slide Votes (without poll)</b> Slide Index: {{slide.slideIndex}}
                                    <table class="table table-striped table-condensed table-hover">
                                        <thead>
                                        <tr>
                                            <th class="id">Vote</th>
                                            <th class="name">Vote Time</th>
                                            <th class="description">Attendee ID</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="slidevote in slide.slideVoteses | orderBy:'voteTime'">
                                            <td>{{slidevote.slideOptions.name}}</td>
                                            <td>{{slidevote.voteTime  | date:'medium'}}</td>
                                            <td>{{slidevote.attendee.ip}}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </li>
                        </ul>


                    </div>

                </script>

            </div>
        </div>

    </section>

    <footer>
        <hr/>

    </footer>

</div>
<script src="js/libs/angular-1.1.5/angular.js"></script>
<script src="js/libs/angular-1.1.5/angular-resource.js"></script>
<script type="text/javascript">



    angular.module('myfilters2',[]).filter('totalNegative', function(){

        return function(items) {
            var total = 0, i = 0;

            for (i = 0; i < items.length; i++){
                if(items[i].slideGroupOptions.name === 'wtf'){
                    total += 1;
                }
            }
            return total;
        }
    });

    angular.module('myfilters',['myfilters2']).filter('totalPositive', function(){

        return function(items) {
            var total = 0, i = 0;
            for (i = 0; i < items.length; i++){
                if(items[i].slideGroupOptions.name === 'nice'){
                    total += 1;
                }
            }
            return total;
        }
    });

    angular.module('myfilters3',['myfilters']).filter('ngGridFilter', function(){
        console.log('filter');

        return function(items) {
//            $scope.myData = items;
            return {data:items};
        }
    });

    angular.module('project', ['myfilters3']).
            config(function($routeProvider) {
                $routeProvider.
                        when('/', {controller:ListCtrl, templateUrl:'list.html'}).
                        otherwise({redirectTo:'/'});
            });





    function ListCtrl($scope,$http) {

        var lineChartData = {
            labels : [],
            datasets : [
                {
                    fillColor : "rgba(220,220,220,0.5)",
                    strokeColor : "rgba(220,220,220,1)",
                    pointColor : "rgba(220,220,220,1)",
                    pointStrokeColor : "#fff",
                    data : []
                },
                {
                    fillColor : "rgba(151,187,205,0.5)",
                    strokeColor : "rgba(151,187,205,1)",
                    pointColor : "rgba(151,187,205,1)",
                    pointStrokeColor : "#fff",
                    data : []
                }
            ]

        }

        $scope.refreshData = function(epn,callback){
            epn = (epn || 178)
            $http.get('http://onslyde.com/go/analytics/' + epn).
                    success(function (data, status, headers, config) {
                        callback(data);
                    }).
                    error(function (data, status, headers, config) {
                        console.error(data, status, headers, config);
                    });
        }

        var refreshInput;
        $scope.declareEndpoint = function(e){
            //simple debounce/throttle
            if(!refreshInput){
                refreshInput = setTimeout(function(){

                    $scope.$apply(function(){

                        $scope.refreshData($scope.endpointName,function(data){
                            $scope.projects = data;

                            //build chart
                            angular.forEach($scope.projects.slideGroups, function(value, key){

                                if(value['created']){
                                    var date = new Date(value.created);
                                    date = date.toLocaleString();
                                    lineChartData.labels.push(date)
                                }

                                lineChartData.datasets[0].data.push(1)
                                lineChartData.datasets[1].data.push(2)
                            })
//                            var myLine = new Chart(document.getElementById("canvas").getContext("2d")).Line(lineChartData);


                        })
                        refreshInput = false;
                    })
                },1000)
            }

        }

        //init
        $scope.declareEndpoint();

        $scope.isDeep = function(item){
            //can be better, just see if object for now
//            console.log(Object.prototype.toString.call(item),item);
            return (Object.prototype.toString.call(item) === "[object Array]" || Object.prototype.toString.call(item) === "[object Object]");
        };

        $scope.isDate = function(item){
//            console.log(item)
            return (item === "created");
        };


        var auth_token;



    }

    ListCtrl.$inject = ['$scope', '$http'];

</script>
</body>
</html>
